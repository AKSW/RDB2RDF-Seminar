@prefix dc:      <http://purl.org/dc/elements/1.1/> .
@prefix dcterms: <http://purl.org/dc/terms/> .
@prefix rdfs:    <http://www.w3.org/2000/01/rdf-schema#> .
@prefix foaf:    <http://xmlns.com/foaf/0.1/> .
@prefix xsd:     <http://www.w3.org/2001/XMLSchema#> .
@prefix rdf:     <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .

@prefix rr:      <http://www.w3.org/ns/r2rml#> .

@prefix vocab:    <http://example.org/vocab/> .
@prefix instance:      <http://example.org/resource/> .
@prefix mapping: <http://exmaple.org/mapping/>.


mapping:ReviewMapping
	rr:logicalTable [
#		rr:tableName "review"];
		rr:sqlQuery """SELECT r.*, p.last_name  FROM review r join person p ON (r.person_id = p.id)"""];
	rr:predicateObjectMap 
		[ 
			rr:objectMap[  
				rr:column "text"; 
				rr:language "en" ];
        	rr:predicate rdfs:label;
		] ;
	rr:predicateObjectMap 
		[ 
			rr:objectMap[ rr:template "http://example.org/resource/product{product_id}" ];
        	rr:predicate vocab:aboutProduct;
		] ;
rr:predicateObjectMap 
		[ 
			rr:objectMap[ 
				rr:parentTriplesMap mapping:PersonMapping;
				rr:joinCondition[
					rr:parent "id";
					rr:child "person_id";
				];
			];
        	rr:predicate dcterms:creator;
		] ;		

	rr:subjectMap
		[ rr:class vocab:Review ;
          rr:template "http://example.org/resource/writtenby{last_name}/review{id}/"
        ] .

mapping:PersonMapping
      rr:logicalTable
      		 [
                rr:tableName "person"
              ] ;
      rr:predicateObjectMap
              [ rr:objectMap
                        [ rr:column "first_name"
                        ] ;
                rr:predicate foaf:firstName
              ] ;
 	  rr:predicateObjectMap
              [ rr:objectMap
                        [ rr:template "{first_name} {last_name}";
						  rr:termType rr:Literal;
                        ] ;
                rr:predicate rdfs:label
              ] ;
       rr:predicateObjectMap
              [ rr:objectMap
                        [ rr:column "last_name"
                        ] ;
                rr:predicate foaf:givenName
              ] ;        
       rr:predicateObjectMap
              [ rr:objectMap
                        [ rr:column "age"
                        ] ;
                rr:predicate vocab:age
              ] ;        
      rr:predicateObjectMap
              [ rr:objectMap
                        [ rr:template "mailto:{mbox}"
						  
                        ] ;
                rr:predicate foaf:mbox
              ] ;
                    rr:predicateObjectMap
              [ rr:objectMap
                        [ rr:template "http://downlode.org/rdf/iso-3166/countries#{country}"
                        ] ;
                rr:predicate vocab:country
              ] ;   
      rr:subjectMap
              [ rr:class foaf:Person ;
                rr:template "http://example.org/resource/person{id}"
              ] .

mapping:ProductMapping
	rr:logicalTable [
		rr:tableName "product"]; 
	rr:predicateObjectMap 
		[ 
			rr:object  "name" ;
        	rr:predicate rdfs:label
		] ;
	rr:predicateObjectMap 
		[ 
			rr:object "description" ;
			rr:predicate rdfs:comment
        ] ;
    rr:predicateObjectMap 
		[ 
			rr:object "producer" ;
			rr:predicate dcterms:creator;
        ] ;
    rr:predicateObjectMap 
		[ 
			rr:objectMap [ 
				rr:column "resolution_x"; 
];
			rr:predicate vocab:resolution_x
        ] ;
    rr:predicateObjectMap 
		[ 
			rr:objectMap [ 
				rr:column "resolution_y"; 
];
			rr:predicate vocab:resolution_y
        ] ;
	rr:predicateObjectMap 
		[ 
			rr:object "color" ;
			rr:predicate vocab:color
        ] ;
    rr:predicateObjectMap 
		[ 
			rr:object "date" ;
			rr:predicate dcterms:created
        ] ;    
	rr:subjectMap
		[ rr:class vocab:Product ;
          rr:template "http://example.org/resource/product{id}"
        ] .



